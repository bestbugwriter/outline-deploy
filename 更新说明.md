# æ›´æ–°è¯´æ˜

## ğŸ‰ æœ¬æ¬¡æ›´æ–°å†…å®¹

### 1. æ–°å¢ RSS æœåŠ¡å¥—ä»¶
- **RSSHub** - RSS æºç”Ÿæˆå™¨ (172.16.0.90:1200)
- **Browserless** - æ— å¤´æµè§ˆå™¨æœåŠ¡
- **FreshRSS** - RSS é˜…è¯»å™¨ (172.16.0.92:80)

### 2. é…ç½®é‡ç”¨æœºåˆ¶ï¼ˆé‡è¦ï¼‰
**æ ¸å¿ƒæ”¹è¿›**ï¼š`config.sh` ç°åœ¨ä¼šè‡ªåŠ¨é‡ç”¨ `deploy.conf` ä¸­çš„å·²æœ‰å¯†ç ï¼Œä¸ä¼šæ¯æ¬¡éƒ½é‡æ–°ç”Ÿæˆã€‚

```bash
# ä¹‹å‰ï¼šæ¯æ¬¡éƒ½é‡æ–°ç”Ÿæˆ
export POSTGRES_PASSWORD=$(randomString16)

# ç°åœ¨ï¼šåªåœ¨ä¸å­˜åœ¨æ—¶ç”Ÿæˆ
setIfEmpty POSTGRES_PASSWORD "$(randomString16)"
```

**æ•ˆæœ**ï¼š
- âœ… å¤šæ¬¡æ‰§è¡Œå¯†ç ä¿æŒä¸€è‡´
- âœ… å‡çº§æ—¶æ—§å¯†ç è‡ªåŠ¨ä¿ç•™
- âœ… æ–°æœåŠ¡å¯†ç è‡ªåŠ¨ç”Ÿæˆ

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å…¨æ–°éƒ¨ç½²
```bash
./deploy.sh service
```

### å·²æœ‰ç¯å¢ƒå‡çº§
```bash
# 1. å¤‡ä»½é…ç½®ï¼ˆé‡è¦ï¼ï¼‰
cp deploy.conf deploy.conf.backup

# 2. æ‹‰å–æ–°ä»£ç 
git pull

# 3. éƒ¨ç½²ï¼ˆè‡ªåŠ¨é‡ç”¨æ—§å¯†ç ï¼‰
./deploy.sh service
```

### å¯ç”¨ RSS æœåŠ¡
```bash
# åœ¨ config.sh ä¸­ä¿®æ”¹
export RSS_ENABLED=true

# æˆ–åœ¨ deploy.conf ä¸­æ·»åŠ 
echo "RSS_ENABLED=true" >> deploy.conf

# ç„¶åéƒ¨ç½²
./deploy.sh service
```

## ğŸ“‹ é…ç½®é‡ç”¨åŸç†

### å·¥ä½œæµç¨‹
1. `config.sh` å¯åŠ¨æ—¶æ£€æŸ¥ `deploy.conf` æ˜¯å¦å­˜åœ¨
2. å¦‚æœå­˜åœ¨ï¼Œå…ˆåŠ è½½å·²æœ‰é…ç½®
3. ä½¿ç”¨ `setIfEmpty` åªä¸ºæ–°å˜é‡ç”Ÿæˆå€¼
4. `deploy.sh` å®Œæˆåä¿å­˜é…ç½®åˆ° `deploy.conf`

### ä»£ç å®ç°
```bash
# config.sh å¼€å¤´
if [ -f "deploy.conf" ]; then
    echo "Found deploy.conf, loading existing configuration..."
    set -a
    source deploy.conf
    set +a
fi

# æ¡ä»¶è®¾ç½®å‡½æ•°
function setIfEmpty() {
    local var_name=$1
    local var_value=$2
    if [ -z "${!var_name}" ]; then
        export "$var_name=$var_value"
    fi
}
```

## ğŸ“ é…ç½®è¯´æ˜

### æœåŠ¡å¼€å…³
```bash
MINIO_ENABLED=false    # Minio å¯¹è±¡å­˜å‚¨
DRAWIO_ENABLED=false   # Draw.io ç»˜å›¾
GRIST_ENABLED=false    # Grist è¡¨æ ¼
RSS_ENABLED=false      # RSS æœåŠ¡å¥—ä»¶ï¼ˆæ–°å¢ï¼‰
```

### RSS é…ç½®å˜é‡
```bash
# RSSHub
RSSHUB_IP=172.16.0.90
RSSHUB_PORT=1200
RSSHUB_ACCESS_KEY=<è‡ªåŠ¨ç”Ÿæˆ>

# Browserless
BROWSERLESS_IP=172.16.0.91
BROWSERLESS_PORT=3000

# FreshRSS
FRESHRSS_IP=172.16.0.92
FRESHRSS_ADMIN_USER=admin
FRESHRSS_ADMIN_PASSWORD=<è‡ªåŠ¨ç”Ÿæˆ>
FRESHRSS_DB_NAME=freshrss_db
FRESHRSS_DB_USER=freshrss_user
FRESHRSS_DB_PASSWORD=<è‡ªåŠ¨ç”Ÿæˆ>

# Telegramï¼ˆå¯é€‰ï¼‰
TELEGRAM_SESSION=
TELEGRAM_TOKEN=
```

### æŸ¥çœ‹ç”Ÿæˆçš„å¯†ç 
```bash
# æŸ¥çœ‹æ‰€æœ‰é…ç½®
cat deploy.conf

# æŸ¥çœ‹ç‰¹å®šå¯†ç 
grep FRESHRSS_ADMIN_PASSWORD deploy.conf
grep RSSHUB_ACCESS_KEY deploy.conf
```

## âš ï¸ é‡è¦æé†’

1. **ä¸€å®šè¦å¤‡ä»½ deploy.conf** - åŒ…å«æ‰€æœ‰å¯†ç 
2. **ä¸è¦æäº¤ deploy.conf åˆ° git** - å·²åœ¨ .gitignore ä¸­
3. **å‡çº§å‰å…ˆå¤‡ä»½é…ç½®æ–‡ä»¶**
4. **RSS æœåŠ¡é»˜è®¤å…³é—­**ï¼Œéœ€è¦è®¾ç½® `RSS_ENABLED=true` å¯ç”¨

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•é‡ç½®æŸä¸ªå¯†ç ï¼Ÿ
```bash
# ç¼–è¾‘ deploy.confï¼Œåˆ é™¤è¦é‡ç½®çš„å¯†ç è¡Œ
vim deploy.conf
# åˆ é™¤: POSTGRES_PASSWORD=xxx

# é‡æ–°æ‰§è¡Œ
source config.sh
./deploy.sh restart postgresql
```

### Q: å¦‚ä½•å®Œå…¨é‡æ–°å¼€å§‹ï¼Ÿ
```bash
# åˆ é™¤æ‰€æœ‰é…ç½®å’Œæ•°æ®
rm -f deploy.conf
rm -rf */data */logs

# é‡æ–°éƒ¨ç½²
./deploy.sh service
```

### Q: FreshRSS æ— æ³•è¿æ¥æ•°æ®åº“ï¼Ÿ
```bash
# é‡å¯ PostgreSQLï¼ˆä¼šæ‰§è¡Œåˆå§‹åŒ–è„šæœ¬ï¼‰
./deploy.sh restart postgresql

# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦åˆ›å»º
docker exec postgres psql -U postgres -c "\l" | grep freshrss
```

### Q: å¦‚ä½•é…ç½® Telegramï¼Ÿ
```bash
# ç¼–è¾‘ deploy.conf
vim deploy.conf

# æ·»åŠ ä½ çš„ Telegram é…ç½®
TELEGRAM_SESSION=your_session_string
TELEGRAM_TOKEN=your_bot_token

# é‡å¯ RSSHub
cd rss && docker compose restart rsshub
```

## ğŸ“Š æ–‡ä»¶å˜æ›´

### ä¿®æ”¹çš„æ–‡ä»¶
- `config.sh` - æ·»åŠ é…ç½®é‡ç”¨é€»è¾‘å’Œ RSS é…ç½®
- `deploy.sh` - æ·»åŠ  RSS éƒ¨ç½²é€»è¾‘
- `postgresql/docker-compose.yml` - æ·»åŠ  FreshRSS ç¯å¢ƒå˜é‡
- `postgresql/init-db.sh` - æ·»åŠ  FreshRSS æ•°æ®åº“åˆ›å»º
- `.gitignore` - æ·»åŠ æ•°æ®ç›®å½•å’Œ deploy.conf

### æ–°å¢çš„æ–‡ä»¶
- `rss/docker-compose.yml` - RSS æœåŠ¡é…ç½®
- `rss/README.md` - RSS æœåŠ¡è¯´æ˜
- `rss/å¿«é€Ÿå¼€å§‹.md` - RSS å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ§ª æµ‹è¯•

### éªŒè¯é…ç½®é‡ç”¨
```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
./test_idempotency.sh
```

### æ‰‹åŠ¨æµ‹è¯•
```bash
# ç¬¬ä¸€æ¬¡æ‰§è¡Œ
./deploy.sh service
grep POSTGRES_PASSWORD deploy.conf  # è®°å½•å¯†ç 

# ç¬¬äºŒæ¬¡æ‰§è¡Œ
./deploy.sh service
grep POSTGRES_PASSWORD deploy.conf  # åº”è¯¥ç›¸åŒ
```

## ğŸ“¦ RSS æœåŠ¡è¯¦æƒ…

### è®¿é—®æ–¹å¼
- **RSSHub**: `http://172.16.0.90:1200`
  - å¥åº·æ£€æŸ¥: `/healthz?key=<ACCESS_KEY>`
- **FreshRSS**: `http://172.16.0.92`
  - ç”¨æˆ·å: `admin`
  - å¯†ç : æŸ¥çœ‹ `deploy.conf`

### æ•°æ®æŒä¹…åŒ–
- FreshRSS æ•°æ®: `rss/fr-data/`
- FreshRSS æ‰©å±•: `rss/fr-extensions/`

### å¤‡ä»½ RSS æ•°æ®
```bash
cd rss
tar czf rss-backup-$(date +%Y%m%d).tar.gz fr-data fr-extensions
```

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** æŸ¥çœ‹ `rss/README.md` äº†è§£æ›´å¤š RSS æœåŠ¡è¯¦æƒ…ã€‚
